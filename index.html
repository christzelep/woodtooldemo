<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Woodworking Assistant (FREE DEMO)</title>

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#3498db" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <style>
        /* ... υπάρχον CSS ... */
        
        /* Install button */
        .install-banner {
            text-align: center;
            margin: 25px 0;
        }
        .install-button {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.3s;
            user-select: none;
        }
        .install-button:hover {
            transform: scale(1.05);
            background: #8e44ad;
        }
        .install-button img {
            filter: invert(1);
            display: block;
        }
        #installMessage {
            margin-top: 10px;
            color: #27ae60;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ... υπάρχον HTML ... -->

        <!-- PWA Install Button -->
        <div class="install-banner">
            <button id="installButton" class="install-button" type="button" style="display:none;">
                <img src="icons/download-icon.png" alt="Install" width="20" />
                Install App
            </button>
            <div id="installMessage"></div>
        </div>

        <!-- ... υπάρχον HTML ... -->
    </div>

    <script>
        function optimizeCuts() {
            // ... υπάρχον κώδικας ...
        }

        // ===== PWA INSTALLATION HANDLING =====
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        const installMessage = document.getElementById('installMessage');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show the install button
            installButton.style.display = 'inline-flex';
            
            // Check if the app is already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                installMessage.textContent = 'App is already installed!';
                installButton.style.display = 'none';
            }
        });

        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) {
                installMessage.textContent = 'Installation not available in this browser';
                return;
            }
            
            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                installMessage.textContent = 'App installed successfully!';
                installButton.textContent = '✅ Installed';
                installButton.disabled = true;
            } else {
                installMessage.textContent = 'Installation cancelled';
            }
            
            // Clear the deferredPrompt variable
            deferredPrompt = null;
        });

        // Event listener for app installed event
        window.addEventListener('appinstalled', () => {
            installMessage.textContent = 'App installed successfully!';
            installButton.textContent = '✅ Installed';
            installButton.disabled = true;
        });

        // Check if running in standalone mode (already installed)
        if (window.matchMedia('(display-mode: standalone)').matches) {
            installMessage.textContent = 'App is already installed!';
            installButton.style.display = 'none';
        }

        // ===== SERVICE WORKER REGISTRATION =====
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                        installMessage.textContent = 'Offline support not available';
                    });
            });
        } else {
            installMessage.textContent = 'Service Workers not supported in this browser';
        }
    </script>
</body>
</html>
